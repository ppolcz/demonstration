\ProvidesPackage{polcz}

\RequirePackage{physics}
\RequirePackage{xparse}
\RequirePackage{amsmath}
\RequirePackage[utf8]{inputenc}

% http://ctan.org/pkg/tcolorbox
\RequirePackage[breakable,skins]{tcolorbox}
\tcbuselibrary{theorems}

% \usepackage[
%     hyperfootnotes = false,
%     colorlinks = true,
%     linkcolor = blue,
%     urlcolor  = blue,
%     citecolor = blue,
%     anchorcolor = blue,
%     pagebackref = false
%     ]{hyperref}

% Options
\DeclareOption{nohref}{\let\hrefopt = 0}
\DeclareOption{ownhref}{\let\hrefopt = 1}
\DeclareOption{href}{\let\hrefopt = 2}
\DeclareOption{nothm}{\let\thm = 0}
\DeclareOption{thmhu}{\let\thm = 1}
\DeclareOption{thmen}{\let\thm = 2}
\DeclareOption{ccsgyak}{\let\ccsgyak = 1}
\ExecuteOptions{nohref}
\ProcessOptions\relax

\ifx\hrefopt 2
    \RequirePackage{hyperref}
    \let\hrefopt = 1
\fi

% Brackets and braces
% REDEFINED, AND AUGMENTED BASED ON Physics 1.3 package
\DeclareDocumentCommand\quantity{}{{\ifnum\z@=`}\fi\@quantity}
\DeclareDocumentCommand\@quantity{ t\big t\Big t\bigg t\Bigg g o d() d|| d<> }
{ % Flexible automatic bracketing of an expression in () or [] or {} or ||
    % Handles manual override of sizing
    \IfBooleanTF{#1}{\let\ltag\bigl \let\rtag\bigr}{
        \IfBooleanTF{#2}{\let\ltag\Bigl \let\rtag\Bigr}{
            \IfBooleanTF{#3}{\let\ltag\biggl \let\rtag\biggr}{
                \IfBooleanTF{#4}
                {\let\ltag\Biggl \let\rtag\Biggr}
                {\let\ltag\left \let\rtag\right}
            }
        }
    }
    % Handles actual bracketing
    \IfNoValueTF{#5}{
        \IfNoValueTF{#6}{
            \IfNoValueTF{#7}{
                \IfNoValueTF{#8}{
                    \IfNoValueTF{#9}
                    {()}
                    {\ltag<{#9}\rtag>}
                }
                {\ltag(#7\rtag) \IfNoValueTF{#9}{}{|#9|}}
            }
            {\ltag(#7\rtag) \IfNoValueTF{#8}{}{|#8|}}
        }
        {\ltag[#6\rtag] \IfNoValueTF{#7}{}{(#7)} \IfNoValueTF{#8}{}{|#8|}}
    }
    {\ltag\lbrace#5\rtag\rbrace  \IfNoValueTF{#6}{}{[#6]} \IfNoValueTF{#7}{}{(#7)} \IfNoValueTF{#8}{}{|#8|}}
    \ifnum\z@=`{\fi}
}
\DeclareDocumentCommand\qty{}{\quantity} % Shorthand for \quantity
\DeclareDocumentCommand\pqty{ l m }{\braces#1{\lparen}{\rparen}{#2}}
\DeclareDocumentCommand\bqty{ l m }{\braces#1{\lbrack}{\rbrack}{#2}}
\DeclareDocumentCommand\Bqty{ l m }{\braces#1{\lbrace}{\rbrace}{#2}}
\DeclareDocumentCommand\vqty{ l m }{\braces#1{\lvert}{\rvert}{#2}}
\DeclareDocumentCommand\dqty{ l m }{\braces#1{<}{>}{#2}}

\DeclareDocumentCommand\dmqty{m}{\left<\begin{matrix}#1\end{matrix}\right>}
\DeclareDocumentCommand\sdmqty{m}{\dqty{\begin{smallmatrix}#1\end{smallmatrix}}}



\ifx\hrefopt 1

    \newcounter{todoAngol}
    \providecommand\langol[2][]{%
        \addtocounter{todoAngol}{1}%
        \global\csdef{taName\thetodoAngol}{#2}%
        \global\csdef{taLabel\thetodoAngol}{#1}%
        \hypertarget{ta:\thetodoAngol}{}\hyperlink{taBack:\thetodoAngol}{#2}%
    }
    \providecommand\refangol[2][]{%
        \global\csdef{taDesc:#1}{#2}%
    }
    \providecommand\angol[2][]{%
        \addtocounter{todoAngol}{1}%
        \global\csdef{taDesc\thetodoAngol}{#1}%
        \global\csdef{taName\thetodoAngol}{#2}%
        \hypertarget{ta:\thetodoAngol}{}\hyperlink{taBack:\thetodoAngol}{#2}%
    }
    \providecommand\angolI[2][]{\angol[#2]{#1}}
    \providecommand{\listoftodosangol}[1]
    {
        \newpage
        \section*{Megjegyzések angol kifejezések és helyesírás kapcsán}

        \ifboolexpr{ test {\ifnumcomp{0}{=}{\thetodoAngol}} }
        { % then
        }
        { % else
            \begin{enumerate}
                \foreach \x in {1,...,\thetodoAngol} {
                    \item \hypertarget{taBack:\x}{}\hyperlink{ta:\x}{\csuse{taName\x}} -- \csuse{taDesc\x}\csuse{taDesc:\csuse{taLabel\x}}
                    % taLabel: $\csuse{taLabel\x}$
                }
            \end{enumerate}

            % \foreach \x in {1,...,\thetodoAngol} {
            %     \csuse{taName\x} \\
            % }
        }
    }
\else

\fi


% \DeclareDocumentCommand{\pcbTitleHelper}{s O{} O{}}
% {
%     \IfBooleanTF{#4}{%
%         #2 \hfill\color{#1} {\footnotesize \tt #3}%
%     }{%
%         #2 \hfill\color{#1} \textit{\footnotesize #3}
%     }
% }

\newtcbox{\TODO}[1][red]{on line,arc=5pt,colback=#1!10!white,colframe=#1!50!black,
    before upper={\rule[-3pt]{0pt}{10pt}},boxrule=1pt, boxsep=0pt,left=4pt,right=4pt,top=2pt,bottom=2pt}

\newtcbox{\TODOx}[1][red]{on line,arc=5pt,colback=#1!10!white,colframe=#1!50!black,
    before upper={\rule[-3pt]{0pt}{10pt}},boxrule=1pt, boxsep=0pt,left=6pt,right=6pt,top=6pt,bottom=6pt}

%\DeclareDocumentEnvironment{\TODOx}{s O{red} m D<>{6pt} D<>{6pt} D<>{2pt} D<>{2pt}}
%{
%    \IfBooleanTF{#1}{%
%        \begin{tcolorbox}[on line,arc=7pt,colback=#2!10!white,colframe=#2!50!black,
%            before upper={\rule[-3pt]{0pt}{10pt}},boxrule=1pt, boxsep=0pt,left=#4,right=#5,top=#6,bottom=#7]#3\end{tcolorbox}
%    }{%
%        \begin{tcolorbox}[on line,arc=7pt,colback=#2!10!white,colframe=#2!50!black,
%            before upper={\rule[-3pt]{0pt}{10pt}},boxrule=1pt, boxsep=0pt,left=8pt,right=8pt,top=8pt,bottom=8pt]#3\end{tcolorbox}
%    }
%}
%{}

\DeclareDocumentCommand{\pcbTitleHelper}{m m m t\matlab}
{
    \IfBooleanTF{#4}{%
        #2 \hfill\color{#1} {\normalsize \tt #3}%
    }{%
        #2 \hfill\color{#1} \textit{\normalsize #3}
    }
}

% Colorbox
\colorlet{cImportantBaseColor}{red!50!black}
\colorlet{cImportantTitleColor}{cImportantBaseColor!10}
\colorlet{cImportantBackColor}{cImportantBaseColor!35!yellow!10}
\definecolor{cMatlabBaseColor}{rgb}{0.95,0.95,0.95}
% o: optional tcolorbox arguments
% g: title
% O: title comment
% O: base color
% O: background color
% O: title background color
\DeclareDocumentEnvironment{pcolorbox}
{ o g O{} O{cImportantBaseColor} O{cImportantBackColor} O{cImportantTitleColor} O{cImportantBaseColor} t\matlab}
{%
    \IfBooleanTF{#8}{
        \begin{tcolorbox}[
        oversize,
        enhanced,
        breakable,
        colback=cMatlabBaseColor,
        boxrule=1pt, arc=4pt, left=6pt, right=6pt, top=6pt, bottom=6pt,
        boxsep=0pt,
        toptitle=4pt,
        bottomtitle=4pt,
        fonttitle=\bfseries,
        coltitle=black,
        colbacktitle=cMatlabBaseColor!90!black,
        subtitle style={
            boxrule=0.4pt,
            colback=cMatlabBaseColor!90!black},
        % lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white},
        title=\pcbTitleHelper{#7}{\IfNoValueF{#2}{#2}}{#3}\matlab,
        \IfNoValueT{#2}{\IfNoValueT{#3}{notitle}},
        \IfNoValueF{#1}{#1}
        ]%
    }{
        \begin{tcolorbox}[
        oversize,
        enhanced,
        breakable,
        colframe=#4!50, colback=#5,
        colbacktitle=#6,
        boxrule=1pt, arc=4pt, left=6pt, right=6pt, top=6pt, bottom=6pt,
        boxsep=0pt,
        toptitle=4pt,
        bottomtitle=4pt,
        fonttitle=\bfseries,
        coltitle=black,
        subtitle style={
            boxrule=0.4pt,
            colback=#6},
        % lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white},
        title=\pcbTitleHelper{#7}{\IfNoValueF{#2}{#2}}{#3},
        \IfNoValueT{#2}{\IfNoValueT{#3}{notitle}},
        \IfNoValueF{#1}{#1}
        ]%
    }%
}{%
    \end{tcolorbox}%
}

\DeclareDocumentEnvironment{pcbox}
{ s o g O{} O{cImportantBaseColor} O{cImportantBackColor} O{cImportantTitleColor} O{cImportantBaseColor} t\matlab}
{%
    \IfBooleanTF{#8}{
        \begin{tcolorbox}[
        oversize,
        enhanced,
        breakable,
        colback=cMatlabBaseColor,
        boxrule=1pt, arc=4pt, left=6pt, right=6pt, top=6pt, bottom=6pt,
        boxsep=0pt,
        toptitle=4pt,
        bottomtitle=4pt,
        fonttitle=\bfseries,
        coltitle=black,
        colbacktitle=cMatlabBaseColor!90!black,
        subtitle style={
            boxrule=0.4pt,
            colback=cMatlabBaseColor!90!black},
        % lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white},
        title=\pcbTitleHelper{#7}{\IfNoValueF{#2}{#2}}{#3}\matlab,
        \IfNoValueT{#2}{\IfNoValueT{#3}{notitle}},
        \IfNoValueF{#1}{#1}
        ]%
    }{
        \begin{tcolorbox}[
        oversize,
        enhanced,
        breakable,
        colframe=#4!50, colback=#5,
        boxrule=1pt, arc=4pt, left=6pt, right=6pt, top=6pt, bottom=6pt,
        boxsep=0pt,
        toptitle=4pt,
        bottomtitle=4pt,
        fonttitle=\bfseries,
        coltitle=black,
        colbacktitle=#6,
        subtitle style={
            boxrule=0.4pt,
            colback=#6},
        % lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white},
        title=\pcbTitleHelper{#7}{\IfNoValueF{#2}{#2}}{#3},
        \IfNoValueT{#2}{\IfNoValueT{#3}{notitle}},
        \IfNoValueF{#1}{#1}
        ]%
    }%
}{%
    \end{tcolorbox}%
}


\DeclareDocumentCommand{\pcbsub}{ s g O{} O{cImportantBaseColor} t\matlab}
{%
    \tcbsubtitle{%
        \IfBooleanTF{#5}{%
            \pcbTitleHelper{#4}{\IfNoValueF{#2}{#2}}{#3}\matlab%
        }{%
            \pcbTitleHelper{#4}{\IfNoValueF{#2}{#2}}{#3}%
        }%
    }%
}


\DeclareDocumentEnvironment{pcbexample}
{s G{} O{}}
{%
    \IfBooleanTF{#1}
    {\begin{pcolorbox}{#2}[#3][blue][blue!10][blue!20]}%
    {\begin{pcolorbox}[notitle]{}[][blue][blue!10][blue!20]}%
}{
    \end{pcolorbox}
}






\DeclareDocumentCommand{\Hiba}{s t\it t\n O{red} g}
{
    \IfNoValueTF{#5}
    {%
        \color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape}%
        \IfBooleanT{#3}{\normalfont}%
    }
    {%
        {\color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape} #5}%
        \IfBooleanT{#3}{\normalfont}%
    }
}

\DeclareDocumentCommand{\Atir}{s t\it t\n O{blue} g}%
{%
    \IfNoValueTF{#5}%
    {%
        \color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape}%
        \IfBooleanT{#3}{\normalfont}%
    }{%
        {\color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape} #5}%
        \IfBooleanT{#3}{\normalfont}%
    }%
}

\DeclareDocumentCommand{\Normal}{s t\it t\n O{black} g}
{
    \IfNoValueTF{#5}
    {%
        \color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape}%
        \IfBooleanT{#3}{\normalfont}%
    }
    {%
        {\color{#4}%
        \IfBooleanT{#1}{\bfseries}%
        \IfBooleanT{#2}{\itshape} #5}%
        \IfBooleanT{#3}{\normalfont}%
    }
}





\ifx\thm 1

    \providecommand\lemmaTitle{Lemma}
    \providecommand\remarkTitle{Remark}
    \providecommand\propositionTitle{Állítás}
    \providecommand\applicationTitle{Alkalmazás}
    \providecommand\exampleTitle{Példa}
    \providecommand\theoremTitle{Tétel}
    \providecommand\definitionTitle{Definíció}
    \providecommand\proofTitle{Bizonyítás}
    \providecommand\solutionTitle{Megoldás}

\else\ifx\thm 2

    \providecommand\lemmaTitle{Lemma}
    \providecommand\remarkTitle{Remark}
    \providecommand\propositionTitle{Proposition}
    \providecommand\applicationTitle{Application}
    \providecommand\exampleTitle{Example}
    \providecommand\theoremTitle{Theorem}
    \providecommand\definitionTitle{Definition}
    \providecommand\proofTitle{Proof}
    \providecommand\solutionTitle{Solution}

\fi\fi


\ifx\thm\undefined
\else

    \newcounter{pczexample}
    \DeclareDocumentEnvironment{example}
    {s G{\exampleTitle} o t\hun}
    {%
        \refstepcounter{pczexample}%
        \bigbreak\noindent%
        \IfBooleanTF{#4}
            {\textbf{\thepczexample. {#2}. }\IfNoValueF{#3}{(#3) }}
            {\textbf{{#2} \thepczexample. }\IfNoValueF{#3}{(#3) }}%
    }
    {
        \phantom{.}\hfill$\triangleleft$
    }

    \DeclareDocumentEnvironment{cExample}
    {s G{\exampleTitle} o O{} t\hun}
    {%
        \smallbreak\noindent\refstepcounter{pczexample}%
        \IfBooleanTF{#1}
        {\begin{pcbexample}*{\IfBooleanTF{#5}{\thepczexample. {#2}. }{{#2} \thepczexample. }\normalfont #3}[#4]}
        {\begin{pcbexample}\textbf{\IfBooleanTF{#5}{\thepczexample. {#2}. }{{#2} \thepczexample. }}\IfNoValueF{#3}{(#3) }}%
    }
    {
        \end{pcbexample}%
    }

    \newcounter{pcztheorem}
    \DeclareDocumentEnvironment{theorem}
    {s o}
    {%
        \refstepcounter{pcztheorem}%
        \bigbreak\noindent\textbf{{\theoremTitle} \thepcztheorem.}\IfNoValueF{#2}{ (#2) }%
    }
    {
        \hfill$\triangleleft$
    }

    \newcounter{pczdefinition}
    \DeclareDocumentEnvironment{definition}
    {s o}
    {\let\emph\textbf%
        \refstepcounter{pczdefinition}%
        \bigbreak\noindent\textbf{{\definitionTitle} \arabic{pczdefinition}.}\IfNoValueF{#2}{ (#2) }\itshape%
    }
    {
        \hfill$\triangleleft$
    }

    \DeclareDocumentEnvironment{cTheorem}
    {s o}
    {%
        \smallbreak\noindent\refstepcounter{pcztheorem}%
        \begin{pcolorbox}{{\theoremTitle} \thepcztheorem.\IfNoValueF{#2}{ \normalfont (#2)}}%
    }{%
        \end{pcolorbox}%
    }


    \newcounter{pczapplication}
    \DeclareDocumentEnvironment{application}
    {s o}
    {
        \refstepcounter{pczapplication}
        \bigbreak\noindent\textbf{{\applicationTitle} \thepczapplication.}\IfNoValueF{#2}{ (#2)}
    }
    {
        \hfill$\triangleleft$
    }

    \DeclareDocumentEnvironment{remark}
    {s o}
    {
        \refstepcounter{pczapplication}
        \bigbreak\noindent\textit{{\remarkTitle} \thepczapplication.}\IfNoValueF{#2}{ (#2)}
    }
    {
        \hfill$\triangleleft$
    }

    \newcounter{pczlemma}
    \DeclareDocumentEnvironment{lemma}
    {s o}
    {
        \refstepcounter{pczlemma}
        \bigbreak\noindent\textbf{{\lemmaTitle} \thepczlemma.}\IfNoValueF{#2}{ (#2)}
    }
    {
        \hfill$\triangleleft$
    }

    \newcounter{pczproposition}
    \DeclareDocumentEnvironment{proposition}
    {s o}
    {
        \refstepcounter{pczproposition}
        \bigbreak\noindent\textbf{{\propositionTitle} \thepczproposition.}\IfNoValueF{#2}{ (#2)}
    }
    {
        \hfill$\triangleleft$\newline
    }

    \DeclareDocumentEnvironment{cProposition}
    {s o}
    {%
        \smallbreak\noindent\refstepcounter{pczproposition}%
        \IfBooleanTF{#1}%
        {\begin{pcolorbox}{{\propositionTitle} \thepczproposition.\IfNoValueF{#2}{ \normalfont(#2)}}}%
        {\begin{pcolorbox}[notitle]\textbf{{\propositionTitle} \thepczproposition.}\IfNoValueF{#2}{ (#2)}}%
        %
    }{%
        \end{pcolorbox}%
    }

    \DeclareDocumentEnvironment{proof}
    {s o}
    {%
        \noindent\textit{{\proofTitle}}\IfNoValueF{#2}{(#2)}\textit{.}%
    }
    {
        \hfill$\square$
    }

    \DeclareDocumentEnvironment{sol}
    {s o}
    {%
        \smallbreak\noindent\textit{{\solutionTitle}}\IfNoValueF{#2}{(#2)}\textit{.}%
    }
    {
        \phantom{.}\hfill\scalebox{0.7}{$\square$}
    }

\fi

\ifx\ccsgyak\undefined\else
    \newcounter{pczmatlab}
    \DeclareDocumentEnvironment{matlab}
    {s o m}
    {
        \begin{pcolorbox}{\refstepcounter{pczmatlab}Matlab \thepczmatlab. %
        \IfNoValueF{#2}{\normalfont #2}}[\tt #3]\matlab
    }
    {
        \end{pcolorbox}
    }

\fi

% max 9 nr of arguments
\DeclareDocumentEnvironment{pczLearnEnvironment}
{s t\alpha t\asdas O{default} m d|| d<> r() R<>{def}}
{
    \noindent{\tt HEADER\_BEGIN} \\
    \IfBooleanTF{#1}{1: STAR}{1: NO STAR} \\
    \IfBooleanTF{#2}{2: alpha}{2: NO alpha} \\
    \IfBooleanTF{#3}{3: beta}{3: NO beta} \\
    \IfNoValueTF{#4}{No fourth argument}{4: #4} \\
    \IfNoValueTF{#5}{No fifth argument}{5: #5} \\
    \IfNoValueTF{#6}{No sixth argument}{6: #6} \\
    \IfNoValueTF{#7}{No seventh argument}{7: #7} \\
    \IfNoValueTF{#8}{No 8th argument}{8: #8} \\
    \IfNoValueTF{#9}{No 9th argument}{9: #9} \\
    \noindent{\tt HEADER\_END} \\
    \noindent{\tt ENVIRONMENT\_BEGIN} \\
}
{
    \noindent{\tt ENVIRONMENT\_END} \\
}

% \begin{pczLearnEnvironment}*\alpha\asdas[b]{}|c|<d>(required argument)<re>
% \end{pczLearnEnvironment}
%
% \begin{pczLearnEnvironment}\alpha{}(required argument)<re>
% \end{pczLearnEnvironment}


\DeclareDocumentCommand\pmat{ s m O{0} m O{0} m }
{
    {
        \newtoks\matrixtoks
        \global\matrixtoks = {}
        \newcount\rowcount
        \newcount\colcount
        \rowcount = #3
        \loop
        \colcount = #5
        {
            \loop
            \edef\addtoks{%
                \ifnum \colcount = #5 \else & \fi
                #2\IfBooleanTF{#1}{%
                    _{%
                        \ifnum #4 > #5 \the\rowcount \fi %
                        \ifnum #6 > #5 \the\colcount \fi
                    }%
                }{}%
            } % indexek
            \global\matrixtoks = \expandafter{\the\expandafter\matrixtoks\addtoks}
            \advance \colcount by 1
            \ifnum \colcount < #6 \repeat
        }
        \advance \rowcount by 1
        \ifnum \rowcount < #4
            \global\matrixtoks = \expandafter{\the\matrixtoks \\ }
            \repeat
    }
    \the\matrixtoks
}




%% NEW THINGS 2017-07-04-17-50-35

% \tcbuselibrary{skins}
\colorlet{bourdon}{red!50!black}
\tcbset{highlight math style={}}
\DeclareDocumentCommand{\hmath}{ s O{} O{red!50!black} g t\margin }
{
    \IfBooleanTF{#5}
    {
        \tcbhighmath[
            enhanced,boxrule=1pt,boxsep=0pt,left=6pt,right=6pt,top=6pt,bottom=6pt,
            remember,colframe=#3!70!black!80,colback=#3!10!white,#2
        ]{#4}
    }
    {
        \tcbhighmath[
            enhanced,boxrule=1pt,boxsep=0pt,left=4pt,right=4pt,top=2pt,bottom=2pt,
            remember,colframe=#3!70!black!80,colback=#3!10!white,#2
        ]{#4}
    }
}

\newlength{\pczoversizelength}
\setlength{\pczoversizelength}{12pt}
\DeclareDocumentEnvironment{pcb}{ s O{} O{red} d<> }
{

    \begin{tcolorbox}[
    enhanced,
    breakable,
    colback=\IfNoValueTF{#4}{#3}{#4}!10,
    colbacktitle=\IfNoValueTF{#4}{#3!20}{#3!10},
    colframe=#3!50,
    subtitle style={boxrule=0.4pt,colback=#3!20},
    boxrule=1pt, arc=4pt, left=0.5\pczoversizelength, right=0.5\pczoversizelength, top=6pt, bottom=6pt,
    boxsep=0pt,
    toptitle=4pt,
    bottomtitle=4pt,
    fonttitle=\bfseries,
    coltitle=black,
    oversize=-\pczoversizelength,
    #2]
}
{
    \end{tcolorbox}
}

\ifx\thm\undefined
\else

\DeclareDocumentEnvironment{absthm}{
s
m m D(){} D||{}                        % [#2 #3 #4 #5] theorem counter, theorem name, title, info
t\hun                                  % [#6]
}
{%
    \refstepcounter{#2}%
    \global\csdef{pczabsthmtitle}%
    {%
        {\bfseries%
            \IfBooleanTF{#6}%
            {%
                \arabic{#2}. #3.%
            }%
            {%
                #3 \arabic{#2}.%
            }%
        }%
        \ifx\hfuzz#4\hfuzz%
        \else%
            \normalfont\IfBooleanTF{#1}{ ({#4})}{ {#4}}%
        \fi%
        \ifx\hfuzz#5\hfuzz%
        \else%
            \hfill%
            {\small\color{bourdon}%
                #5%
            }\IfBooleanT{#1}{\newline}%
        \fi%
    }%%
}%
{%
    \global\csundef{pczabsthmtitle}
}%

\DeclareDocumentEnvironment{thm}{
s
G{\theoremTitle} d() d||               % [#2 #3 #4] theorem name, title, info
t\hun                                  % [#5]
O{} O{bourdon} D<>{bourdon!35!yellow}  % [#6 #7 #8] pcb: tcolorbox properties, color1, color2
G{pcztheorem}
}
{%
    \IfBooleanTF{#1}%
    {%
        \begin{absthm}*{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[#6][#7]<#8>%
        \csuse{pczabsthmtitle}%
    }%
    {%
        \begin{absthm}{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[title={\csuse{pczabsthmtitle}},#6][#7]<#8>%
    }%
}%
{%
    \end{pcb}%
    \end{absthm}%
}%

\DeclareDocumentEnvironment{prop}{
s
G{\propositionTitle} D(){} D||{}          % [#2 #3 #4] theorem name, title, info
t\hun                                     % [#5]
O{} O{bourdon} D<>{bourdon!35!yellow}     % [#6 #7 #8] pcb: tcolorbox properties, color1, color2
G{pczproposition}
}
{%
    \IfBooleanTF{#1}%
    {%
        \begin{absthm}*{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[#6][#7]<#8>%
        \csuse{pczabsthmtitle}%
    }%
    {%
        \begin{absthm}{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[title={\csuse{pczabsthmtitle}},#6][#7]<#8>%
    }%
}%
{%
    \end{pcb}%
    \end{absthm}%
}%

\DeclareDocumentEnvironment{fel}{
s
G{feladat} D(){} D||{}   % [#2 #3 #4] theorem name, title, info
t\hun                    % [#5]
O{} O{blue} D<>{blue}    % [#6 #7 #8] pcb: tcolorbox properties, color1, color2
G{pczexample}
}
{%
    \IfBooleanTF{#1}%
    {%
        \begin{absthm}*{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[oversize,#6][#7]%
        \csuse{pczabsthmtitle}%
    }%
    {%
        \begin{absthm}{#9}{#2}(#3)|#4|\hun%
        \begin{pcb}[oversize,title={\csuse{pczabsthmtitle}},#6][#7]%
    }%
}%
{%
    \end{pcb}%
    \end{absthm}%
}%

\DeclareDocumentEnvironment{feladat}{
s
G{feladat} D(){} D||{}    % [#2 #3 #4] theorem name, title, info
t\hun                     % [#5]
O{} O{blue} D<>{blue}     % [#6 #7 #8] pcb: tcolorbox properties, color1, color2
}
{%
    \begin{absthm}*{pczexample}{#2}(#3)|#4|\hun%
    \bigbreak\noindent\csuse{pczabsthmtitle}%
}%
{%
    \phantom{.}\hfill$\triangleleft$%
    \end{absthm}%
}%

\fi







\definecolor{orange}{rgb}{1,0.5,0}
\definecolor{mygreen}{rgb}{0.2,0.5,0.1}
\definecolor{darkgreen}{HTML}{789130}
\definecolor{scarlet}{HTML}{95081F}
\definecolor{mygreen}{HTML}{058714}
\definecolor{purple}{HTML}{A9006B}

\DeclareDocumentEnvironment{word}
{s m D<>{} d[] d()}
{
    \noindent {\LARGE \bfseries \blue #2 }%
    \IfBooleanTF{#1}{\small[{\bfseries \red formal}] }{}%
    \textcolor{darkgreen}{\textit{\normalsize \mdseries #3} }%
    \IfNoValueTF{#5}{}{\normalsize (\textit{\textcolor{orange}{#5}}) }%
    \begin{enumerate}%
}
{
    \end{enumerate}
}
