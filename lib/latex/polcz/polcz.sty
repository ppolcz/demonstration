\ProvidesPackage{polcz}

\RequirePackage{physics}
\RequirePackage{xparse}
\RequirePackage{amsmath}

% http://ctan.org/pkg/tcolorbox
\RequirePackage[breakable,skins]{tcolorbox}


% \usepackage[
%     hyperfootnotes = false,
%     colorlinks = true,
%     linkcolor = blue,
%     urlcolor  = blue,
%     citecolor = blue,
%     anchorcolor = blue,
%     pagebackref = false
%     ]{hyperref}

% Options
\DeclareOption{nohref}{\let\hrefopt = 0}
\DeclareOption{ownhref}{\let\hrefopt = 1}
\DeclareOption{href}{\let\hrefopt = 2}
\ExecuteOptions{nohref}
\ProcessOptions\relax

\ifx\hrefopt 2
    \RequirePackage{hyperref}
    \let\hrefopt = 1
\fi

% Brackets and braces
% REDEFINED, AND AUGMENTED BASED ON Physics 1.3 package
\DeclareDocumentCommand\quantity{}{{\ifnum\z@=`}\fi\@quantity}
\DeclareDocumentCommand\@quantity{ t\big t\Big t\bigg t\Bigg g o d() d|| d<> }
{ % Flexible automatic bracketing of an expression in () or [] or {} or ||
    % Handles manual override of sizing
    \IfBooleanTF{#1}{\let\ltag\bigl \let\rtag\bigr}{
        \IfBooleanTF{#2}{\let\ltag\Bigl \let\rtag\Bigr}{
            \IfBooleanTF{#3}{\let\ltag\biggl \let\rtag\biggr}{
                \IfBooleanTF{#4}
                {\let\ltag\Biggl \let\rtag\Biggr}
                {\let\ltag\left \let\rtag\right}
            }
        }
    }
    % Handles actual bracketing
    \IfNoValueTF{#5}{
        \IfNoValueTF{#6}{
            \IfNoValueTF{#7}{
                \IfNoValueTF{#8}{
                    \IfNoValueTF{#9}
                    {()}
                    {\ltag<{#9}\rtag>}
                }
                {\ltag(#7\rtag) \IfNoValueTF{#9}{}{|#9|}}
            }
            {\ltag(#7\rtag) \IfNoValueTF{#8}{}{|#8|}}
        }
        {\ltag[#6\rtag] \IfNoValueTF{#7}{}{(#7)} \IfNoValueTF{#8}{}{|#8|}}
    }
    {\ltag\lbrace#5\rtag\rbrace  \IfNoValueTF{#6}{}{[#6]} \IfNoValueTF{#7}{}{(#7)} \IfNoValueTF{#8}{}{|#8|}}
    \ifnum\z@=`{\fi}
}
\DeclareDocumentCommand\qty{}{\quantity} % Shorthand for \quantity
\DeclareDocumentCommand\pqty{ l m }{\braces#1{\lparen}{\rparen}{#2}}
\DeclareDocumentCommand\bqty{ l m }{\braces#1{\lbrack}{\rbrack}{#2}}
\DeclareDocumentCommand\Bqty{ l m }{\braces#1{\lbrace}{\rbrace}{#2}}
\DeclareDocumentCommand\vqty{ l m }{\braces#1{\lvert}{\rvert}{#2}}
\DeclareDocumentCommand\dqty{ l m }{\braces#1{<}{>}{#2}}

\DeclareDocumentCommand\dmqty{m}{\left<\begin{matrix}#1\end{matrix}\right>}
\DeclareDocumentCommand\sdmqty{m}{\dqty{\begin{smallmatrix}#1\end{smallmatrix}}}



\ifx\hrefopt 1

    \newcounter{todoAngol}
    \providecommand\langol[2][]{%
        \addtocounter{todoAngol}{1}%
        \global\csdef{taName\thetodoAngol}{#2}%
        \global\csdef{taLabel\thetodoAngol}{#1}%
        \hypertarget{ta:\thetodoAngol}{}\hyperlink{taBack:\thetodoAngol}{#2}%
    }
    \providecommand\refangol[2][]{%
        \global\csdef{taDesc:#1}{#2}%
    }
    \providecommand\angol[2][]{%
        \addtocounter{todoAngol}{1}%
        \global\csdef{taDesc\thetodoAngol}{#1}%
        \global\csdef{taName\thetodoAngol}{#2}%
        \hypertarget{ta:\thetodoAngol}{}\hyperlink{taBack:\thetodoAngol}{#2}%
    }
    \providecommand\angolI[2][]{\angol[#2]{#1}}
    \providecommand{\listoftodosangol}[1]
    {
        \newpage
        \section*{Megjegyzések angol kifejezések és helyesírás kapcsán}

        \ifboolexpr{ test {\ifnumcomp{0}{=}{\thetodoAngol}} }
        { % then
        }
        { % else
            \begin{enumerate}
                \foreach \x in {1,...,\thetodoAngol} {
                    \item \hypertarget{taBack:\x}{}\hyperlink{ta:\x}{\csuse{taName\x}} -- \csuse{taDesc\x}\csuse{taDesc:\csuse{taLabel\x}}
                    % taLabel: $\csuse{taLabel\x}$
                }
            \end{enumerate}

            % \foreach \x in {1,...,\thetodoAngol} {
            %     \csuse{taName\x} \\
            % }
        }
    }
\else

\fi


\newenvironment{cExample}
    { \begin{tcolorbox}[oversize,skin=bicolor,breakable, colframe=blue!30,colback=blue!10,boxrule=1pt,arc=4pt, left=6pt,right=6pt,top=6pt,bottom=6pt,boxsep=0pt]\begin{example} }
    { \end{example} \end{tcolorbox} }
\newtcbox{\TODO}[1][red]{on line,arc=7pt,colback=#1!10!white,colframe=#1!50!black,
    before upper={\rule[-3pt]{0pt}{10pt}},boxrule=1pt, boxsep=0pt,left=6pt,right=6pt,top=2pt,bottom=2pt}

\DeclareDocumentCommand{\pcbTitleHelper}{m m m}
{#2 \hfill\color{#1} \textit{\footnotesize #3}}

% Colorbox
\colorlet{cImportantBaseColor}{red!50!black}
\colorlet{cImportantTitleColor}{cImportantBaseColor!10}
\colorlet{cImportantBackColor}{cImportantBaseColor!35!yellow!10}
% o:   optional tcolorbox arguments
% d(): title
% d<>: title comment
% O:   base color
% O:   background color
% O:   title background color
\DeclareDocumentEnvironment{pcolorbox}
{ o g O{} O{cImportantBaseColor} O{cImportantBackColor} O{cImportantTitleColor}}
{
    \begin{tcolorbox}[
    oversize,
    breakable,
    colframe=#4!50, colback=#5,
    boxrule=1pt, arc=4pt, left=6pt, right=6pt, top=6pt, bottom=6pt,
    boxsep=0pt,
    toptitle=4pt,
    bottomtitle=4pt,
    fonttitle=\bfseries,
    coltitle=black,
    colbacktitle=#6,
    subtitle style={
        boxrule=0.4pt,
        colback=#6},
    lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white},
    title=\pcbTitleHelper{#4}{\IfNoValueF{#2}{#2}}{#3},
    \IfNoValueT{#2}{\IfNoValueT{#3}{notitle}},
    \IfNoValueF{#1}{#1}
    ]
}
{
    \end{tcolorbox}
}

\DeclareDocumentCommand{\pcbsub}{ s g O{} O{cImportantBaseColor} }
{
    \tcbsubtitle{%
        \pcbTitleHelper{#4}{\IfNoValueF{#2}{#2}}{#3}%
    }
}





\DeclareDocumentCommand{\Hiba}{s t\it O{red} g}
{
    \IfNoValueTF{#4}
    {%
        \color{#3}\IfBooleanT{#1}{\bfseries} \IfBooleanT{#2}{\itshape}%
    }
    {%
        {\color{#3}\IfBooleanT{#1}{\bfseries} \IfBooleanT{#2}{\itshape} #4}%
    }
}

\DeclareDocumentCommand{\Atir}{s t\it O{blue} g}
{
    \IfNoValueTF{#4}
    {%
        \color{#3}\IfBooleanT{#1}{\bfseries} \IfBooleanT{#2}{\itshape}%
    }
    {%
        {\color{#3}\IfBooleanT{#1}{\bfseries} \IfBooleanT{#2}{\itshape} #4}%
    }
}



% max 9 nr of arguments
\DeclareDocumentEnvironment{pczLearnEnvironment}
{s t\alpha t\asdas O{default} m d|| d<> r() R<>{def}}
{
    \noindent{\tt HEADER\_BEGIN} \\
    \IfBooleanTF{#1}{1: STAR}{1: NO STAR} \\
    \IfBooleanTF{#2}{2: alpha}{2: NO alpha} \\
    \IfBooleanTF{#3}{3: beta}{3: NO beta} \\
    \IfNoValueTF{#4}{No fourth argument}{4: #4} \\
    \IfNoValueTF{#5}{No fifth argument}{5: #5} \\
    \IfNoValueTF{#6}{No sixth argument}{6: #6} \\
    \IfNoValueTF{#7}{No seventh argument}{7: #7} \\
    \IfNoValueTF{#8}{No 8th argument}{8: #8} \\
    \IfNoValueTF{#9}{No 9th argument}{9: #9} \\
    \noindent{\tt HEADER\_END} \\
    \noindent{\tt ENVIRONMENT\_BEGIN} \\
}
{
    \noindent{\tt ENVIRONMENT\_END} \\
}

% \begin{pczLearnEnvironment}*\alpha\asdas[b]{}|c|<d>(required argument)<re>
% \end{pczLearnEnvironment}
%
% \begin{pczLearnEnvironment}\alpha{}(required argument)<re>
% \end{pczLearnEnvironment}
